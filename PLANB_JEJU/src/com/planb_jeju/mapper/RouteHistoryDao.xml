<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.planb_jeju.dao.RouteHistoryDao">

	<select id = "getMyHistory" resultType = "com.planb_jeju.dto.RouteHistory">
		SELECT r.routename, rh.*
		FROM route r
		JOIN (
				SELECT 
					rh.route_order as route_order,
					rh.route_code as route_code,
					rh.username as username,
					rh.route_date as route_date,
					rh.update_rownum as update_rownum,
					ifnull(rh.update_reason, '0') as update_reason,
					rh.site, ifnull(sp.comment, '0') as comment
				FROM route_history rh left JOIN site_postscript sp
				ON rh.username = sp.username
					AND rh.route_order = sp.route_order
					AND rh.route_code = sp.route_code
					AND rh.route_date = sp.route_date
					AND rh.update_rownum = sp.update_rownum
				WHERE rh.username = 'a@naver.com' AND rh.route_code = 1
			) rh
		ON r.username = rh.username
			AND r.route_code = rh.route_code;
	</select>
</mapper>